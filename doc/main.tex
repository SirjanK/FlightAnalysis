\documentclass{article}
\usepackage[final]{nips}
\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage[english]{babel}
\usepackage{amsthm}
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{tikz}           % plotting
\usepackage{pgfplots}
\pgfplotsset{compat=1.12}
\usepackage{amsmath,textcomp,amssymb,geometry,graphicx,enumerate}
\usepackage{algorithm} % Boxes/formatting around algorithms
\usepackage[noend]{algpseudocode} % Algorithms

\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{definition}{Defn}[section]

\newcommand\given[1][]{\:#1\vert\:}
\definecolor{mediumpurple}{rgb}{0.58, 0.44, 0.86}

\title{Flight Delay Prediction}

\author{%
  Sirjan Kafle \\
  \texttt{sxkafle12@gmail.com} \\
  \texttt{https://flightdelay.us}
}

\begin{document}

\maketitle

\section{Introduction}
We build an app that models the distribution of flight delays conditioned on variables like:
\begin{itemize}
  \item Origin Airport
  \item Destination Airport
  \item Airline
  \item Time of Day
\end{itemize}

More specifically, we want users to provide a subset of those "conditional variables" and we'll output information on the probability that the delay
time will exceed certain thresholds, e.g. 30 minutes, 1 hour, etc along with plotting those probabilities vs delay time. See figure (TODO attach plot)
as an example.

We are resource constrained based on the container size of the web app we're deploying to, so we describe compression methods for these distributions by modeling them as exponentials - we store
and load the parameters of that distribution for the app rather than full flight data.

In this doc, we explain a general framework for building algorithms to efficiently model these probabilities at scale. We start with describing
how we model conditional distributions as an exponential, then describe an algorithm to handle low data support conditionals - e.g. a configuration
of Origin Airport, Destination Airport, Airline, Time of Day that has very few data points that we can't give a reasonable estimate directly. In 
these cases, our algorithm is a Bayesian model with some assumptions. By doing so, our app can now handle queries for any subset of the conditional
variables. We denote cases where we have low data support in the app marked by an asterick, see figure (TODO attach plot).

\section{Modeling Conditional Distributions as an Exponential}
\subsection{Definitions}
Let $D$ be the continuous random variable representing the delay time of a flight. Let $C_i$ be the $i$th conditional variable, e.g. origin airport.
In our cases $C_i$ are categorical, although they don't have to be. Even for time of day, we've divided it into 4 categories with six hour intervals: morning, afternoon, evening, night.
For the purposes of the theory, we'll derive all our results for generic $C_i$, which means these techniques are extendable to other conditioning variables
in the future.

We describe the PDF of the conditional distribution as $f_D(\delta|\{C_i\}, )$ where $\delta$ is the delay time. What we actually care about, however, are
the cases where $\delta > 0$, meaning modeling the distribution of positive delays well.

\subsection{Motivating Example}
We show an example with the following conditional variables:
\begin{itemize}
  \item $C_1 := \text{Origin Airport}$, $C_1 = \text{San Diego}$
  \item $C_2 := \text{Destination Airport}$, $C_2 = \text{San Francisco}$
  \item $C_3 := \text{Airline}$, $C_3 = \text{Alaska}$
  \item $C_4 := \text{Time of Day}$, $C_4 = \text{Afternoon}$
\end{itemize}
We plot the densities of the real data in figure (TODO). We zoom in on the cases where $\delta > 0$ since we want to model those well.
As shown, the fitted model that we'll derive later models this portion of the density well.

\subsection{Proposed Model}
We want to model:
$$f_D(\delta | \{C_i\}, D > 0)$$
as an exponential distribution with parameter $\lambda$. The full joint distribution can be written as:
\begin{align*}
  f_D(\delta | \{C_i\}) &= 
\end{align*}
$$f_D(\delta|\{C_i\}) = p\lambda e^{-\lambda \delta}$$

\subsection{Maximum Likelihood Estimate of Parameters}
Learn $p$, $\lambda$.
\begin{align*}
    p &= \sum_{i=1}^n 1_{\delta_i > 0} / N \\
    \lambda &= N / \sum_{i=1}^n \delta_i 1_{\delta_i > 0}
\end{align*}

\subsection{MLE Plot and Goodness of Fit}
\subsubsection{Metric}
\subsubsection{Example Fits}
\subsubsection{Score vs Data Size}
\subsubsection{Score vs Conditional Group Profile}
\subsubsection{Bias Variance Tradeoff in Action}

\subsection{Delay Survival Function}
$$P(D>\delta | \{C_i\}) = p e^{-\lambda \delta}$$

\section{Algorithms for Low Data Support Conditionals}
\subsection{Core Problem and Motivating Example}
\subsection{Definitions of Subset Groupings and Partition}
\subsection{Assumption and Setup}
\subsection{Parameter Estimate Derivation Given Partition}
\subsection{Which Partition is Best?}
\subsubsection{Main Idea}
\subsubsection{KL Divergence Derivation}
\subsubsection{Ranking of Partitions Algorithm}

\section{Final Algorithm}
\subsection{Model Fitting}
Defer explanation of the partitions algorithm to earlier.
\subsection{Inference}

\section{Fun Examples}
Attach images from the site

\end{document}